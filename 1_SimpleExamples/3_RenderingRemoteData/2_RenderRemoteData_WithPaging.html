<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>nje/jquery-tmpl: Rendering remote data, with paging</title>
	<link href="../../samples.css" rel="stylesheet" type="text/css" />
	<style type="text/css">
	.movieName	{
		cursor:pointer;
		color: Blue;
	}
	</style>
	<script src="http://code.jquery.com/jquery.js" type="text/javascript"></script>
	<script src="../../jquery.tmpl.js" type="text/javascript"></script>
	<script type="text/javascript">
		var index = 1, genre = "Drama", pageSize = 50, recordsCount = pageSize + 1;

		$(document).ready(function() {
			// Get first page of movie items
			getMovies();

			// Click handlers for next and prev
			$( "#previousBtn" ).click( function() {
				index--;
				getMovies()
			});

			$( "#nextBtn" ).click( function() {
				index++;
				getMovies()
			});
		});

		function getMovies() {
			// Fetch a page of movie items from NetFlix OData JSON service
			// Build the query string
			var query = "http://odata.netflix.com/Catalog/Genres('" + genre + "')/Titles" 
				+ "?$format=json&$orderby=Name&$inlinecount=allpages"
				// skip to first record of page
				+ "&$skip=" + (index-1) * pageSize + "&$top=" + pageSize;

			// Make the AJAX call to the service
			$.ajax({
				dataType: "jsonp",
				url: query,
				jsonp: "$callback",
				success: showMovies
			});
		}

		function showMovies( data ) {
			// Get the movies array from the data
			var movies = data.d.results;
			// Set the number of records, obtained from the service
			recordsCount = data.d.__count;

			// Enable/disable buttons
			$( "#previousBtn" ).attr( "disabled", index > 1 ? "" : "disabled" );
			$( "#nextBtn" ).attr( "disabled", index*pageSize < recordsCount ? "" : "disabled" );

			// Remove current set of movie template items
			$( "#movieList" ).empty();

			// Render the template items for each movie
			$( "#movieTemplate" ).tmpl( movies )
				// and insert the template items into the 'movieList'
				.appendTo( "#movieList" );
		}

		// Add an onclick handler for the movie template items
		$( ".movieName" ).live( "click", function() {
			var movie = $.tmplItem( this ).data;
			alert( "'" + movie.Name + "' was released in " + movie.ReleaseYear + ".\n\n"
			+ (movie.ShortSynopsis || "") ); 
		});

	</script>
</head>
<body>
	<div class="wikiSource">
		<h4>Rendering remote data, with paging</h4>
		This is a live page using the sample code on <br />
		<a href="http://wiki.github.com/nje/jquery-tmpl/simple-examples">http://wiki.github.com/nje/jquery-tmpl/rendering-remote-data</a>
	</div>

	<script id="movieTemplate" type="text/x-jquery-tmpl">
		<li>
			<strong class="movieName">${Name}</strong>
			(${ReleaseYear})
		</li>
	</script>

	<input id="previousBtn" type="button" value="Previous" />
	<input id="nextBtn" type="button" value="Next" />

	<h3>Movies List (Click for info):</h3>
	<ul id="movieList"><li>loading...</li></ul>
</body>
</html>
